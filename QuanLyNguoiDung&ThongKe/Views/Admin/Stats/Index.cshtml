@{
    ViewData["Title"] = "Admin Dashboard";
}
<h2>Admin Dashboard</h2>
<canvas id="usersChart" width="600" height="200"></canvas>
<canvas id="revenueChart" width="600" height="200"></canvas>
<table class="table" id="topUsersTbl"><thead><tr><th>Name</th><th>TotalSpent</th><th>Rentals</th></tr></thead><tbody></tbody></table>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function loadStats(){
  const usersRes = await axios.get('/admin/api/stats/users');
  const revenueRes = await axios.get('/admin/api/stats/revenue');
  const topRes = await axios.get('/admin/api/stats/top-users?limit=10');

  const labels = Object.keys(usersRes.data.newUsersByMonth || {});
  const data = Object.values(usersRes.data.newUsersByMonth || {});
  new Chart(document.getElementById('usersChart'), {
    type: 'bar',
    data: { labels, datasets: [{ label: 'New Users', data }] }
  });

  const revLabels = Object.keys(revenueRes.data || {});
  const revData = Object.values(revenueRes.data || {});
  new Chart(document.getElementById('revenueChart'), {
    type: 'line',
    data: { labels: revLabels, datasets: [{ label: 'Revenue', data: revData }] }
  });

  const tbody = document.querySelector('#topUsersTbl tbody');
  tbody.innerHTML = '';
  (topRes.data || []).forEach(u => {
    tbody.innerHTML += `<tr><td>${u.name}</td><td>${u.totalSpent}</td><td>${u.totalRentals}</td></tr>`;
  });
}
loadStats();
</script>
