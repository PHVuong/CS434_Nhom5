@{
    ViewData["Title"] = "User Management";
}
<h2>User Management</h2>

<input id="q" placeholder="Search by name/email" />
<select id="role"><option value="">All roles</option><option>Admin</option><option>Staff</option><option>Customer</option></select>
<select id="isLocked"><option value="">All</option><option value="false">Active</option><option value="true">Locked</option></select>
<button id="btnSearch">Search</button>
<table class="table">
<thead><tr><th>Id</th><th>Name</th><th>Email</th><th>Role</th><th>Locked</th><th>Actions</th></tr></thead>
<tbody id="userBody"></tbody>
</table>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
async function load(page=1){
    const q = document.getElementById('q').value;
    const role = document.getElementById('role').value;
    const isLocked = document.getElementById('isLocked').value;
    let url = `/admin/api/users?page=${page}&pageSize=20&q=${encodeURIComponent(q)}&role=${role}`;
    if(isLocked !== '') url += `&isLocked=${isLocked}`;
    const res = await axios.get(url);
    const data = res.data.items;
    const tbody = document.getElementById('userBody');
    tbody.innerHTML = '';
    data.forEach(u => {
        tbody.innerHTML += `<tr>
            <td>${u.id}</td>
            <td>${u.fullName}</td>
            <td>${u.email}</td>
            <td>${u.role}</td>
            <td>${u.isLocked}</td>
            <td>
              <a href="#" onclick="toggleLock(${u.id}, ${u.isLocked})">${u.isLocked ? 'Unlock':'Lock'}</a> |
              <a href="#" onclick="deleteUser(${u.id})">Delete</a>
            </td>
        </tr>`;
    });
}

async function toggleLock(id, current){
  const newStatus = !current;
  await axios.patch(`/admin/api/users/${id}/lock`, { isLocked: newStatus });
  await load();
}
async function deleteUser(id){
  if(!confirm('Delete user?')) return;
  await axios.delete(`/admin/api/users/${id}`);
  await load();
}
document.getElementById('btnSearch').addEventListener('click', () => load());
load();
</script>
